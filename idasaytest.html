<script>
  let djMode = false; // garde l'état (normal / DJ)

  async function updateDjInfo() {
    const now = new Date();
    const parisTime = new Date(now.toLocaleString("en-US", { timeZone: "Europe/Paris" }));
    const hour = parisTime.getHours();

    const target = document.getElementById("info-block");
    if (!target) return;

    // Si déjà en mode DJ → on ne touche plus à rien
    if (djMode) return;

    // Seulement si on est à 23h
    if (hour === 18) {
      try {
        const res = await fetch("https://radio.spaceghost.pink/dj/info.json", { cache: "no-store" });
        if (!res.ok) return; // JSON absent → ne rien faire

        const data = await res.json();

        if (data && data.pseudo && data.reseaux && data.texte) {
          // JSON valide → on remplace une seule fois et on reste comme ça
          target.innerHTML = `
            <h3><a href="${data.reseaux}" target="_blank">${data.pseudo}</a></h3>
            <p>${data.texte}</p>
          `;
          djMode = true; // verrouillage
        }
      } catch (err) {
        console.warn("Erreur JSON DJ info :", err);
      }
    }
  }

  // vérifie toutes les 30s si on doit passer en mode DJ
  updateDjInfo();
  setInterval(updateDjInfo, 30000);
</script>
